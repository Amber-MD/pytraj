os: Windows Server 2012

# We need printf exponents to have 2 digits like the C standard says,
# or tests will fail. Set environment variable for mingw-w64:
# https://github.com/Alexpux/mingw-w64/blob/master/mingw-w64-crt/stdio/mingw_pformat.c#L223
#
# cpptraj.lib
# https://ci.appveyor.com/project/hainm/cpptraj-l282n/build/artifacts
environment:
  matrix:
    - PYTHON: "C:\\Miniconda3"
      CONDA_PY: "35"
      CONDA_NPY: "1.10"

install:
  # use conda from Miniconda3 first
  - set PATH=%PYTHON%;%PYTHON%/Scripts:%PATH%
  - conda install cython -y
  - python scripts/cythonize.py
  # now go back to mingw64
  - set HOME=.
  - set MSYSTEM=MINGW64
  - set PATH=C:/msys64/usr/bin;C:/msys64/mingw64/bin;%PATH%
  - "sh -lc \"pacman -S --noconfirm --needed
      mingw-w64-x86_64-openblas
      mingw-w64-x86_64-arpack
      mingw-w64-x86_64-gcc
      mingw-w64-x86_64-gcc-fortran
      mingw-w64-x86_64-ncurses
      mingw-w64-x86_64-readline
      mingw-w64-x86_64-python2-numpy
      diffutils
    \""
  - mkdir cpptraj
  - mv cpptraj.zip cpptraj/
  - cd cpptraj/
  - 7z x cpptraj.zip
  - ls . 
  - ls lib/
  - mv lib/libcpptraj.lib lib/cpptraj.lib
  - cd ../

build_script:
  - where python
  - python setup.py build --disable-openmp
  - python setup.py install
  - set PATH=%cd%/cpptraj/lib;%WINDIR%
  - cd tests
  - python -c "import numpy; print(numpy)"
  - python -c "import pytraj; pytraj.run_tests()"
